<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members - GymFlow Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .gradient-text { background: linear-gradient(135deg, #2196F3, #21CBF3); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-backdrop { backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-blue-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="text-2xl font-bold gradient-text">GymFlow</div>
                    <div class="hidden md:block text-sm text-gray-500">Membership Management System</div>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">Dashboard</a>
                    <a href="members.html" class="text-blue-600 font-medium border-b-2 border-blue-600 pb-1">Members</a>
                    <a href="register.html" class="text-gray-600 hover:text-blue-600 transition-colors">Register</a>
                    <div class="flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full">
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium">A</div>
                        <span class="text-sm font-medium text-gray-700">Admin</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Member Management</h1>
                <p class="text-gray-600 mt-2">Manage your gym membership database</p>
            </div>
            <div class="flex space-x-3">
                <button onclick="exportMembers()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">
                    Export CSV
                </button>
                <a href="register.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    Add New Member
                </a>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="bg-white rounded-xl p-6 shadow-lg mb-8 animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Members</label>
                    <input type="text" id="search-input" placeholder="Search by name or email..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status Filter</label>
                    <select id="status-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="expiring">Expiring Soon</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Plan Filter</label>
                    <select id="plan-filter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">All Plans</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-between items-center mt-4">
                <div class="text-sm text-gray-600">
                    Showing <span id="member-count">0</span> members
                </div>
                <button onclick="clearFilters()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                    Clear Filters
                </button>
            </div>
        </div>

        <!-- Members Table -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden animate-fade-in" style="animation-delay: 0.2s;">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <input type="checkbox" id="select-all" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('name')">
                                Name <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('email')">
                                Email <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('status')">
                                Status <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('joinDate')">
                                Join Date <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('expiryDate')">
                                Expiry Date <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortMembers('amount')">
                                Amount <span class="ml-1 text-gray-400">↕</span>
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody id="members-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Dynamic content will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div id="bulk-actions" class="hidden mt-4 p-4 bg-blue-50 rounded-lg">
            <div class="flex items-center justify-between">
                <span class="text-sm text-blue-800">
                    <span id="selected-count">0</span> members selected
                </span>
                <div class="space-x-2">
                    <button onclick="bulkDelete()" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                        Delete Selected
                    </button>
                    <button onclick="bulkExport()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                        Export Selected
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Member Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop" onclick="closeEditModal()"></div>
            <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-semibold text-gray-800">Edit Member</h3>
                    <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="edit-form" class="space-y-4">
                    <input type="hidden" id="edit-member-id">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="edit-name" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="edit-email" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                        <input type="tel" id="edit-phone" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select id="edit-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="expiring">Expiring Soon</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Membership Plan</label>
                        <select id="edit-plan" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="monthly">Monthly (₱380)</option>
                            <option value="quarterly">Quarterly (₱1,140)</option>
                            <option value="annual">Annual (₱4,200)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                        <input type="date" id="edit-expiry" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <div class="flex space-x-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            Save Changes
                        </button>
                        <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-gray-500">
                <p>&copy; 2024 GymFlow Management System. Streamlining fitness operations with elegance.</p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        let currentSort = { field: 'name', direction: 'asc' };
        let selectedMembers = new Set();

        document.addEventListener('DOMContentLoaded', function() {
            loadMembers();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('search-input').addEventListener('input', debounce(filterMembers, 300));
            document.getElementById('status-filter').addEventListener('change', filterMembers);
            document.getElementById('plan-filter').addEventListener('change', filterMembers);
            document.getElementById('select-all').addEventListener('change', toggleSelectAll);
            document.getElementById('edit-form').addEventListener('submit', saveMember);
        }

        function loadMembers() {
            const members = getMembers();
            displayMembers(members);
            updateMemberCount(members.length);
        }

        function displayMembers(members) {
            const tbody = document.getElementById('members-table-body');
            
            if (members.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                            <div class="text-lg font-medium mb-2">No members found</div>
                            <div class="text-sm">Try adjusting your search criteria or add a new member.</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = members.map(member => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <input type="checkbox" value="${member.id}" class="member-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" onchange="toggleMemberSelection(${member.id})">
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <span class="text-sm font-medium text-blue-600">${member.name.charAt(0)}</span>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${member.name}</div>
                                <div class="text-sm text-gray-500">${member.phone}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${member.email}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusClass(member.status)}">
                            ${member.status.charAt(0).toUpperCase() + member.status.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${formatDate(member.joinDate)}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${formatDate(member.expiryDate)}</td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-900 mono">₱${member.amount.toLocaleString()}</td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <button onclick="editMember(${member.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Edit
                            </button>
                            <button onclick="deleteMemberConfirm(${member.id})" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterMembers() {
            const searchTerm = document.getElementById('search-input').value;
            const statusFilter = document.getElementById('status-filter').value;
            const planFilter = document.getElementById('plan-filter').value;
            
            const filteredMembers = window.GymFlow.filterMembers(searchTerm, statusFilter, planFilter);
            displayMembers(filteredMembers);
            updateMemberCount(filteredMembers.length);
        }

        function clearFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('plan-filter').value = '';
            filterMembers();
        }

        function sortMembers(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            
            const members = getMembers();
            members.sort((a, b) => {
                let aVal = a[field];
                let bVal = b[field];
                
                if (field === 'amount') {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                } else if (field.includes('Date')) {
                    aVal = new Date(aVal);
                    bVal = new Date(bVal);
                }
                
                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            displayMembers(members);
        }

        function editMember(id) {
            const members = getMembers();
            const member = members.find(m => m.id === id);
            
            if (member) {
                document.getElementById('edit-member-id').value = member.id;
                document.getElementById('edit-name').value = member.name;
                document.getElementById('edit-email').value = member.email;
                document.getElementById('edit-phone').value = member.phone;
                document.getElementById('edit-status').value = member.status;
                document.getElementById('edit-plan').value = member.plan;
                document.getElementById('edit-expiry').value = member.expiryDate;
                
                document.getElementById('edit-modal').classList.remove('hidden');
            }
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }

        function saveMember(e) {
            e.preventDefault();
            
            const id = document.getElementById('edit-member-id').value;
            const updates = {
                name: document.getElementById('edit-name').value,
                email: document.getElementById('edit-email').value,
                phone: document.getElementById('edit-phone').value,
                status: document.getElementById('edit-status').value,
                plan: document.getElementById('edit-plan').value,
                expiryDate: document.getElementById('edit-expiry').value
            };
            
            // Update amount based on plan
            const planAmounts = {
                'monthly': 380,
                'quarterly': 1140,
                'annual': 4200
            };
            updates.amount = planAmounts[updates.plan];
            
            const success = window.GymFlow.updateMember(id, updates);
            
            if (success) {
                window.GymFlow.showToast('Member updated successfully!');
                closeEditModal();
                loadMembers();
            } else {
                window.GymFlow.showToast('Failed to update member', 'error');
            }
        }

        function deleteMemberConfirm(id) {
            if (confirm('Are you sure you want to delete this member?')) {
                const success = window.GymFlow.deleteMember(id);
                if (success) {
                    window.GymFlow.showToast('Member deleted successfully!');
                    loadMembers();
                } else {
                    window.GymFlow.showToast('Failed to delete member', 'error');
                }
            }
        }

        function toggleMemberSelection(id) {
            if (selectedMembers.has(id)) {
                selectedMembers.delete(id);
            } else {
                selectedMembers.add(id);
            }
            updateBulkActions();
        }

        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.member-checkbox');
            const selectAll = document.getElementById('select-all');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                const memberId = parseInt(checkbox.value);
                if (selectAll.checked) {
                    selectedMembers.add(memberId);
                } else {
                    selectedMembers.delete(memberId);
                }
            });
            
            updateBulkActions();
        }

        function updateBulkActions() {
            const bulkActions = document.getElementById('bulk-actions');
            const selectedCount = document.getElementById('selected-count');
            
            selectedCount.textContent = selectedMembers.size;
            
            if (selectedMembers.size > 0) {
                bulkActions.classList.remove('hidden');
            } else {
                bulkActions.classList.add('hidden');
            }
        }

        function bulkDelete() {
            if (confirm(`Are you sure you want to delete ${selectedMembers.size} selected members?`)) {
                selectedMembers.forEach(id => {
                    window.GymFlow.deleteMember(id);
                });
                selectedMembers.clear();
                updateBulkActions();
                window.GymFlow.showToast('Selected members deleted successfully!');
                loadMembers();
            }
        }

        function bulkExport() {
            const members = getMembers().filter(m => selectedMembers.has(m.id));
            window.GymFlow.exportToCSV(members);
        }

        function exportMembers() {
            const members = getMembers();
            window.GymFlow.exportToCSV(members);
        }

        function updateMemberCount(count) {
            document.getElementById('member-count').textContent = count;
        }

        // Utility functions from main.js
        function getStatusClass(status) {
            return window.GymFlow.getStatusClass(status);
        }

        function formatDate(dateString) {
            return window.GymFlow.formatDate(dateString);
        }

        function getMembers() {
            return window.GymFlow.getMembers();
        }

        function debounce(func, wait) {
            return window.GymFlow.debounce(func, wait);
        }
    </script>
</body>
</html>